<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Sensor Data Table</title>
  <style>
    table {
      width: 60%;
      margin: 40px auto;
      border-collapse: collapse;
    }
    th, td {
      padding: 12px 20px;
      border: 1px solid #ccc;
      text-align: left;
    }
    th {
      background-color: #f4f4f4;
    }
    .status-indicator {
      position: absolute;
      top: 20px;
      left: 20px;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background-color: red;
      animation: pulsate 1.5s infinite;
    }

    .online {
      background-color: green;
    }

    @keyframes pulsate {
      0% {
        transform: scale(1);
      }
      50% {
        transform: scale(1.2);
      }
      100% {
        transform: scale(1);
      }
    }
  </style>
</head>
<body>
  <h2 style="text-align:center;">Sensor Data Table</h2>
  <div class="status-indicator" id="statusIndicator"></div>
  <table>
    <thead>
      <tr>
        <th>ID</th>
        <th>Temperature</th>
        <th>Humidity</th>
        <th>Gas</th>
        <th>DateTime</th>
      </tr>
    </thead>
    <tbody>
      <% sensorData.forEach(data => { %>
        <tr>
          <td><%= data.id %></td>
          <td><%= data.temperature %></td>
          <td><%= data.humidity %></td>
          <td><%= data.gas %></td>
          <td><%= data.recorded_at %></td>
        </tr>
      <% }); %>
    </tbody>
  </table>
  <script>
    function checkStatus() {
      fetch('/sensor-status')
        .then(response => response.json())
        .then(data => {
          const statusIndicator = document.getElementById('statusIndicator');
          if (data.status === 'online') {
            statusIndicator.classList.add('online');
            statusIndicator.classList.remove('offline');
          } else {
            statusIndicator.classList.remove('online');
            statusIndicator.classList.add('offline');
          }
        });
    }

    setInterval(checkStatus, 6000);
    checkStatus(); // Run initially
  </script>
</body>
</html>